<div class="shell" [class.sidebar-closed]="!sidebarService.isOpen()">
  <app-sidebar appName="GeStock" [isOpen]="sidebarService.isOpen()"></app-sidebar>

  <!-- Overlay para mÃ³vil -->
  @if (sidebarService.isMobile() && sidebarService.isOpen()) {
  <div class="sidebar-overlay" (click)="sidebarService.close()"></div>
  }

  <main class="content">
    <!-- Topbar -->
    <header class="topbar">
      <button class="icon-btn" aria-label="toggle menu" (click)="toggleSidebar()">â˜°</button>

      <!-- acciones Topbar -->
      <nav class="actions">
        @for (a of header.actionsTopbar(); track a.label) {
        <a
          [routerLink]="a.link || null"
          (click)="a.onClick?.()"
          class="btn"
          [class.primary]="a.variant === 'primary'"
        >
          @if (a.icon) {
          <span class="ico">{{ a.icon }}</span>
          } {{ a.label }}
        </a>
        }

        <!-- BotÃ³n de usuario con nombre -->
        <button class="btn user-btn">
          <span class="ico">ðŸŸ¢</span>
          {{ getUserName() }}
        </button>

        <!-- BotÃ³n de cerrar sesiÃ³n -->
        <button (click)="openLogoutModal()" class="btn" title="Cerrar sesiÃ³n">Cerrar SesiÃ³n</button>
      </nav>
    </header>

    <!-- Breadcrumbs -->
    @if (header.breadcrumbs().length) {
    <div class="breadcrumbs">
      @for (bc of header.breadcrumbs(); track bc.label; let last = $last) {
      <ng-container>
        @if (bc.link) {
        <a [routerLink]="bc.link">{{ bc.label }}</a>
        } @else {
        <span class="muted">{{ bc.label }}</span>
        } @if (!last) {
        <span class="sep">/</span>
        }
      </ng-container>
      }
    </div>
    }

    <!-- Page title -->
    @if (header.title() || header.actionsTitle().length) {
    <div class="title-row">
      <h2 class="page-title">{{ header.title() }}</h2>

      @if (header.actionsTitle().length) {
      <nav class="actions title-actions">
        @for (a of header.actionsTitle(); track a.label) {
        <a
          [routerLink]="a.link || null"
          (click)="a.onClick?.()"
          class="btn"
          [class.primary]="a.variant === 'primary'"
        >
          @if (a.icon) {
          <span class="ico">{{ a.icon }}</span>
          }
          {{ a.label }}
        </a>
        }
      </nav>
      }
    </div>
    }

    <!-- Main page content -->
    <section class="page">
      <router-outlet></router-outlet>
    </section>
  </main>

  <!-- Modal de confirmaciÃ³n de logout -->
  <app-modal
    [isOpen]="showLogoutModal()"
    title="Cerrar SesiÃ³n"
    [message]="'Â¿EstÃ¡s seguro que deseas cerrar sesiÃ³n, ' + getUserName() + '?'"
    icon="ðŸšª"
    confirmText="SÃ­, cerrar sesiÃ³n"
    cancelText="Cancelar"
    variant="danger"
    (confirm)="confirmLogout()"
    (cancel)="cancelLogout()"
  ></app-modal>
</div>
