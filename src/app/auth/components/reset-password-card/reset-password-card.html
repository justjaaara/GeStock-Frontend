<div class="reset-password-card">
    @if (!isTokenValid()) {
    <div class="invalid-token">
        <div class="icon-error">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        </div>
        <h2>Enlace Inválido</h2>
        <p>El enlace de recuperación no es válido o ha expirado.</p>
        <button type="button" class="btn-secondary" (click)="goToForgotPassword()">
            Solicitar nuevo enlace
        </button>
        <div class="back-to-login">
            <a routerLink="/login" class="link">← Volver al inicio de sesión</a>
        </div>
    </div>
    } @else {
    <div class="card-header">
        <h2>Restablecer Contraseña</h2>
        <p class="subtitle">Ingresa tu nueva contraseña</p>
    </div>

    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
        @if (successMessage()) {
        <div class="alert alert-success">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <span>{{ successMessage() }}</span>
        </div>
        <p class="redirect-text">Redirigiendo al inicio de sesión...</p>
        } @if (errorMessage()) {
        <div class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span>{{ errorMessage() }}</span>
        </div>
        }

        <div class="form-group">
            <label for="newPassword">Nueva Contraseña</label>
            <app-input-field id="newPassword" type="password" placeholder="Ingresa tu nueva contraseña"
                formControlName="Contraseña" [required]="true" />
            @if (newPassword?.invalid && newPassword?.touched) {
            <span class="error-text">
                @if (newPassword?.errors?.['required']) { La contraseña es requerida }
                @else if (newPassword?.errors?.['minlength']) { La contraseña debe
                tener al menos 6 caracteres } @else if
                (newPassword?.errors?.['maxlength']) { La contraseña no puede exceder
                50 caracteres }
            </span>
            }
        </div>

        <div class="form-group">
            <label for="confirmPassword">Confirmar Contraseña</label>
            <app-input-field id="confirmPassword" type="password" placeholder="Confirma tu nueva contraseña"
                formControlName="Confirmar contraseña" [required]="true" />
            @if (confirmPassword?.invalid && confirmPassword?.touched) {
            <span class="error-text">

                @if (confirmPassword?.errors?.['required']) {
                Debes confirmar la contraseña
                } @else if (formErrors?.['passwordMismatch']) {
                Las contraseñas no coinciden }
            </span>
            }
        </div>

        <div class="password-requirements">
            <p class="requirements-title">La contraseña debe contener:</p>
            <ul>
                <li>Al menos 6 caracteres</li>
                <li>Una letra mayúscula</li>
                <li>Una letra minúscula</li>
                <li>Un número</li>
                <li>Un carácter especial (!@#$%^&*)</li>
            </ul>
        </div>

        <button type="submit" class="btn-primary"
            [disabled]="isLoading() || !resetPasswordForm.valid || successMessage()">
            @if (isLoading()) {
            <span class="spinner"></span>
            } @else {
            <span>Restablecer contraseña</span>
            }
        </button>

        <div class="back-to-login">
            <a routerLink="/login" class="link">← Volver al inicio de sesión</a>
        </div>
    </form>
    }
</div>