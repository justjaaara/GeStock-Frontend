<div class="inventory-container">
  <!-- Estad√≠sticas superiores -->
  <div class="grid">
    <app-stat-card title="Total Productos" [value]="stats().totalProducts" icon="üì¶">
    </app-stat-card>

    <app-stat-card
      title="Stock Bajo"
      [value]="stats().lowStockProducts"
      icon="‚ö†Ô∏è"
      variant="warning"
    >
    </app-stat-card>

    <app-stat-card
      title="Stock Cr√≠tico"
      [value]="stats().criticalStockProducts"
      icon="üö®"
      variant="danger"
    >
    </app-stat-card>

    <app-stat-card title="Valor Total" [value]="stats().totalValue" icon="üí∞"> </app-stat-card>
  </div>

  <!-- Panel principal -->
  <div class="panel">
    <div class="panel-header">
      <h4>Inventario de Productos</h4>
    </div>

    <!-- Estados de carga y error -->
    @if (isLoading()) {
    <div style="text-align: center; padding: 2rem">
      <div class="loading-spinner" style="margin: 0 auto 1rem"></div>
      <p>Cargando inventario...</p>
    </div>
    } @if (error()) {
    <div style="text-align: center; padding: 2rem">
      <p style="color: #e74c3c; margin-bottom: 1rem">{{ error() ?? 'Error desconocido' }}</p>
      <button (click)="refreshInventory()" class="btn nav">üîÑ Reintentar</button>
    </div>
    }

    <!-- Controles y filtros -->
    @if (!isLoading() && !error()) {
    <div class="controls">
      <div class="field">
        <select>
          <option>Todas las categor√≠as</option>
          <option>Bebidas</option>
          <option>Alimentos</option>
          <option>Limpieza</option>
        </select>
      </div>

      <div class="field">
        <select>
          <option>Todos los estados</option>
          <option>Activo</option>
          <option>Stock Bajo</option>
          <option>Cr√≠tico</option>
        </select>
      </div>

      <button class="btn nav primary">Filtrar</button>
    </div>

    <!-- Tabla de productos -->
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Producto</th>
            <th>Categor√≠a</th>
            <th>Stock Actual</th>
            <th>Stock M√≠n.</th>
            <th>Precio Unit.</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (product of products(); track product.code) {
          <tr>
            <td>
              <span class="link-id">{{ product.code }}</span>
            </td>
            <td>
              <div class="cell-product">
                <div class="name">{{ product.name }}</div>
                @if (product.subtitle) {
                <div class="sub">{{ product.subtitle }}</div>
                }
              </div>
            </td>
            <td>{{ product.category }}</td>
            <td class="bold">{{ product.stock }}</td>
            <td>{{ product.min }}</td>
            <td class="bold">{{ product.price | currency : 'COP' : 'symbol' : '1.2-2' }}</td>
            <td>
              <span
                class="pill"
                [ngClass]="{
                  ok: product.status === 'Activo',
                  warn: product.status === 'Stock Bajo',
                  crit: product.status === 'Cr√≠tico' || product.status === 'Sin Stock'
                }"
              >
                {{ product.status }}
              </span>
            </td>
            <td class="actions">
              <button class="icon-btn" title="Ver detalles">üëÅÔ∏è</button>
              <button class="icon-btn" title="Editar">‚úèÔ∏è</button>
              <button class="icon-btn" title="M√°s opciones">üîß</button>
            </td>
          </tr>
          }
        </tbody>
      </table>

      <!-- Mensaje cuando no hay productos -->
      @if (products().length === 0) {
      <div style="text-align: center; padding: 2rem; color: #6b7a90">
        <p>No se encontraron productos en el inventario.</p>
      </div>
      }
    </div>

    <!-- Paginaci√≥n -->
    @if (paginationInfo() && paginationInfo()!.totalPages > 1) {
    <div class="panel-foot">
      <div class="page-info">
        Mostrando {{ paginationInfo()!.showingFrom }}-{{ paginationInfo()!.showingTo }} de
        {{ paginationInfo()!.totalItems }} productos
      </div>

      <div style="display: flex; gap: 8px; align-items: center">
        <button (click)="prevPage()" [disabled]="!paginationInfo()?.hasPrevious" class="btn nav">
          ‚Üê Anterior
        </button>

        @for (page of getPaginationPages(); track page) {
        <button
          (click)="goToPage(page)"
          [class]="page === paginationInfo()!.currentPage ? 'btn nav primary' : 'btn nav'"
        >
          {{ page }}
        </button>
        }

        <button (click)="nextPage()" [disabled]="!paginationInfo()?.hasNext" class="btn nav">
          Siguiente ‚Üí
        </button>
      </div>
    </div>
    } }
  </div>
</div>
